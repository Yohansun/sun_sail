<div class="container-fluid">
  <div class="row-fluid">
    <%= render partial: "layouts/setting_nav" %>
    <div class="span10">
      <div class="row-fluid">
        <ul class="breadcrumb" style="position:relative;">
          <li><a href="/">Magic</a><span class="divider">/</span></li>
          <li class="active">地域管理</li>
        </ul><!-- breadcrumb -->

        <%= form_tag areas_path, :method => :post, :id => "parent_area" do %>
            <div class="btn-toolbar">
              <div class="btn-group">
                <b class="btn btn-warning">操作</b>
                <button class="btn btn-warning dropdown-toggle" data-toggle="dropdown" onclick="return false">
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to "查看下级", "#",:onclick => "validateValues(this)",:goto => "/areas",:request => "get" %>
                  </li>
              </div>
            </div>

            <table class="table table-striped table-bordered table-condensed td_colors mar_t js-table">
              <thead>
                <tr>
                  <th width="1%"><input type="checkbox"></th>
                  <th>邮编</th>
                  <th>名称</th>
                  <th>上级区域</th>
                </tr>
              </thead>
              <tbody>
                <% @areas.each do |area| %>
                  <tr>
                    <td><input type="checkbox" value="<%= area.id %>" name="parent_id"></td>
                    <td><%= area.zip %></td>
                    <td><%= area.name %></td>
                    <td>
                    <% if area.parent.present? %>
                      <%= area.parent.name %>
                    <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  function validateValues(item){
    var check_values = $('input:checked').map(function(){if($(this).val() != 'on'){return ($(this).val())}});
    if($('input:checked').length < 1) {  
      alert('请选择');  
    } else if($.inArray('<%= current_user.id %>',check_values) >= 0 && $(item).attr("goto") != "/areas"){  
      alert('不能操作自己哦 ╮(╯_╰)╭');
    } else {
      $('#parent_area').attr({action: $(item).attr("goto") ,method: $(item).attr("request") });  
      $('#parent_area').submit();  
    }
  }
</script>
