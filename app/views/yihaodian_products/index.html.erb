<div class="row-fluid">
  <div class="span10 w100">
  <!-- <div class="row-fluid"> -->
    <%= render partial: "layouts/all_crumbs" %>
    <%= render partial: "products/sidebar" %>
    <div class="tab-content">
      <div class="tab-pane active" id="stock_check">
        <form class="well well-small form-horizontal font12">
          <fieldset>
            <div class="control-group">
              <label class="pull-left"><code>精准：</code></label>
              <div class="controls pull-left">
                <select name="key" class="input-small pull-left select2 radius_no_rb">
                  <option value="product_id_eq" <%= 'selected' if params[:key] == "product_id_eq" %>>商品ID</option>
                  <option value="product_cname_eq" <%= 'selected' if params[:key] == "product_cname_eq" %>>商品名称</option>
                </select>
                <input type="text" class="input-medium radius_no_tl" name="value" value="<%= params[:value] %>" placeholder="输入关键字...">
              </div>
              <div class="pull-left">
                <button type="button pull-left" class="btn btn-small btn-primary">搜索</button>
              </div>
            </div>
          </fieldset><!-- form line1 area -->
        </form>
      </div>

      <div class="btn-toolbar">
        <div class="btn-group">
          <button class="btn btn-warning">操作</button>
          <button class="btn btn-warning dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li><a href="#" id="show_jingdong_product">查看</a></li>
            <li><a href="#" id="tie_to_native_skus">绑定本地SKU</a></li>
          </ul>
        </div><!-- btn-group -->
        <div class="btn btn-warning"><%= link_to "同步一号店数据", sync_yihaodian_products_path %></div>
      </div><!-- btn-groups end -->

      <div class="tab-content">
        <div class="tab-pane" id="native_goods">
        </div><!-- single_good end -->

        <div class="tab-pane active" id="jingdong_goods">
          <table class="table table-hover table-bordered table-striped table-condensed" id="jingdong_product_table">
            <thead>
              <tr>
                <th><!-- <input type="radio"> --></th>
                <% %w(product_code
                      product_cname
                      product_id
                      ean13
                      category_id
                      can_sale
                      outer_id
                      can_show
                      verify_flg
                      is_dup_audit
                      brand_id
                      merchant_category_id
                      ).each do |th| %>
                <th><%= column_humanize "yihaodian_product.#{th}" %></th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <%- @products.each do |product| %>
              <tr id='product_<%= product.id %>'>
                <td><input class='jingdong_product_check' name="jingdong_product_radio" type="radio"></td>
                <td><%= product.product_code %></td>
                <td><%= product.product_cname %></td>
                <td><%= product.product_id %></td>
                <td><%= product.ean13 %></td>
                <td><%= product.category_id %></td>
                <td><%= product.can_sale_name %></td>
                <td><%= product.outer_id %></td>
                <td><%= product.can_show? ? "是" : "否" %></td>
                <td><%= product.verify_flg_name %></td>
                <td><%= product.is_dup_audit_name %></td>
                <td><%= product.brand_id %></td>
                <td><%= product.merchant_category_id %></td>
              </tr>
              <%- end %>
            </tbody>
          </table>

          <div class='clearfix'>
            <div class="pull-right" style="margin-left: 5px;margin-top: -2px;">
              <%= paginate @products %>
            </div>
            <!-- <p></p> -->
            <%= form_tag("/jingdong_products", :method => "get", :class => 'pagination trade_count_info form-inline pull-right') do %>
            <input style="visibility:hidden;" name="page" value="<%= params[:page]%>"/>
            <label style="color:#005580;">当前每页显示：</label>
            <%=select_tag :number, options_for_select([["加载20项","20"],
                    ["加载50项","50"],
                    ["加载100项", "100"]], params[:number]),  :class => 'nomargin input-medium', :onchange => "this.form.submit();" %>
            <%- end -%>
          </div>
        </div><!-- all_goods end -->
      </div>
    </div>
  </div>
</div>

<% content_for :tail do %>
<script type="text/javascript">
  $('#show_jingdong_product').on('click', function(event){
    event.preventDefault()
    if($('#jingdong_product_table input:checked').length == 1){
      var product_id = $('#jingdong_product_table input:checked').parents('tr').attr('id')
      product_id = _.trim(product_id, "product_")
      window.location.href = "/yihaodian_products/"+product_id
    } else{
      alert("请选择一件商品。");
    }
  })

  $('table#jingdong_product_table tr').click(function() {
    $(this).find('td input:radio').prop('checked', true);
  })
</script>
<% end %>