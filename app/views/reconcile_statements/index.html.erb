<div class="container-fluid">
  <header class="jumbotron subhead" id="overview">
    <div class="subnav">
      <ul class="nav nav-pills">
        <li class="active"><a href="#">运营商对账</a></li>
        <!-- <li><a href="#">经销商对账</a></li>
        <li><a href="#">财务对账</a></li> -->
      </ul>
    </div>
  </header>
  <div class="row-fluid">
    <ul class="breadcrumb" style="position:relative;">
      <li><a href="#">Magic</a><span class="divider">/</span></li>
      <li><a href="#">财务管理</a><!-- <span class="divider">/</span> --></li>
      <!-- <li class="active">用户管理</li> -->
      <!-- <li style="position:absolute;right:15px;top:6px;"><a class="btn_alert" href="#">店铺维护</a></li> -->
    </ul><!-- breadcrumb -->

    <form class="well form-search">
      <fieldset class="form-inline">
        <div class="controls">
          <label>店铺选择</label>
          <select id="" class="input-medium">
            <% @trade_sources.each do |ts|%>
            <option><%= ts.name %></option>
            <% end %>
          </select>

          <label class="control-label">选择时间：</label>
          <div class="input-append">
            <input type="text" class="input-small datepickers">
            <button type="button" class="btn btn-info">搜索</button>
          </div>
        </div>
      </fieldset>
    </form>

    <div class="btns">
      <a href="javascript:;" class="btn btn-warning">导出数据</a>
      <a data-toggle="modal" href="#confirm_account" class="btn btn-warning">确认结算</a>
      <a href="javascript:;" class="btn btn-warning disabled">不可用确认结算</a>
    </div>

    <table class="table table-striped table-bordered td_colors table-hover mar_t">
      <thead>
        <tr>
          <th><input type="checkbox"></th>
          <th>月份</th>
          <th>店铺</th>
          <th></th>
          <th>结算金额</th>
          <th>结算状态</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <%@rs_set.each do |rs| %>
        <tr class="rs_row" id="rs_<%= rs.id %>" data-row="<%= rs.id %>">
          <td><input type="checkbox"></td>
          <td><%= rs.audit_time.strftime("%Y-%m") %></td>
          <td><%= rs.trade_store_name %></td>
          <td><%= rs.trade_store_source %></td>
          <td><%= rs.balance_amount %></td>
          <%- if rs.audited %>
          <td>已结算</td>
          <%- else %>
          <td><a data-toggle="modal" data-id="<%= rs.id %>" href="#confirm_account" class="confirm_settlement">未结算</a></td>
          <%- end %>
          <td>
            <div class="btn-group">
              <button data-toggle="dropdown" class="btn btn-info dropdown-toggle"><i class="icon-wrench"></i> <span class="caret"></span></button>
              <ul class="dropdown-menu" style="left:-115px;">
                <li><a href="javascript:;">导出</a></li>
                <%- unless rs.audited %>
                <li><a data-toggle="modal" data-id="<%= rs.id %>" href="#confirm_account" class="confirm_settlement">确认结算</a></li>
                <%- end %>
              </ul>
            </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>

    <div id="reconcile_table"></div>

  </div>
</div>

<div id="confirm_account" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h3>确定结算</h3>
  </div><!-- modal-header -->
  <div class="modal-body sure_id">
    <p>确认结算对账?</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary confirm_button" type="submit">确定</button>
  </div>
</div><!-- confirm_account -->

<%- content_for :tail do %>
<script type = "text/javascript">
  var rs_id = null;
  $('.confirm_settlement').click(function(argument) {
    rs_id = $(this).data('id');
    var rs_month = $("#rs_"+rs_id+" td:eq(1)").html();
    $('.sure_id').text("确认结算"+ rs_month +"月份对账？");
  })
  $('.confirm_button').click(function(argument) {
    $.ajax({
      type: "PUT",
      url: "/reconcile_statements/"+rs_id+"/audit"
    }).done(function(result){
      $('#confirm_account').modal('hide');
      $("#rs_"+rs_id+" td:eq(5)").html("已结算");
    })
  })
  $('.rs_row').click(function(argument) {
    rs_row = $(this).data('row');
    $.get("/reconcile_statements/"+rs_row+".js", function(result){
     });
  })
</script>
<%- end %>