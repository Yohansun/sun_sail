<style>
.form-horizontal .controls {
  margin-left: 0px;
}
.input-small.select2.product {
  width: 800px!important;
}
.row-fluid.product {
  min-height: 0px;
}
.input-small.select2.logictic {
  width: 150px!important;
}
</style>

<div class="row-fluid">
  <div class="span2 bs-docs-sidebar">
    <ul class="nav nav-list bs-docs-sidenav affix span2">
      <li class="active"><a href="#"><i class="icon-chevron-right"></i>默认仓库</a></li>
    </ul>
  </div>

  <div class="span10">
    <ul class="nav nav-tabs">
      <li class="active"><%= link_to "新建入库单", new_stock_in_bill_path %></li>
      <li><%= link_to "库存查询", stocks_path %></li>
      <li><%= link_to "入库单", stock_in_bills_path %></li>
      <li><%= link_to "出库单", stock_out_bills_path %></li>
      <li><%= link_to "所有进销", stock_bills_path %></li>
    </ul><!-- nav-tabs -->  
    <%= simple_form_for @bill,:html => {:class => "form-horizontal"} do |f| %>
    <%= hidden_field_tag "bill_product_ids" %>
    <div class="btn-toolbar">
      <%= f.submit "保存",:onclick => "
      if($('input[name=\"bill_product_ids[]\"]').length < 1){
        alert('请选择至少一个商品');
        return false;
        }else{
          var checked_ids = $('input[name=\"bill_product_ids[]\"]:checked').map(function(){ return this.value }).get().join(',');$('#bill_product_ids').val(checked_ids)
        }",:class => "btn btn-warning btn-small" %>
        <%= link_to "取消","/stock_in_bills" ,:class => "btn btn-warning btn-small" %>
      </div>
      <div class="well clearfix">
        <fieldset class="span6">
          <%= f.input :op_name, label: "发货人",:input_html  => {:class => "input-medium"} %>
          <%= f.input :op_mobile, label: "手机",:input_html  => {:class => "input-medium"} %>
          <%= f.input :op_zip, label: "邮编",:input_html  => {:class => "input-medium"} %>
          
          <div class="control-group">
            <label class="control-label">收货仓库：</label>
            <select class="input-medium select2">
              <option value="默认仓库">默认仓库</option>
            </select>
          </div>
          <div class="control-group">
            <%= f.input :stock_type,label: "出库类型", collection: StockInBill::STOCK_TYPE, as: :select,:input_html => {class: "input-medium select2"} %>
          </div>
        </fieldset><!-- form left area -->
        <fieldset class="span6">
          <%= f.input :op_phone, label: "固定电话",:input_html  => {:class => "input-medium"},:placeholder => "010-10101010" %>
          <%= f.input :op_address, label: "收货地址",:input_html  => {:class => "input-medium"} %>
          
          <div class="control-group">
            <label class="control-label">地域：</label>
            <select id="" class="level_1 input-medium input-small pull-left radius_no_rb select2" name="stock_in_bill[op_state]">
              <option>省</option>
            </select>
            <select id="" class="level_2 input-medium input-small pull-left radius_no select2" name="stock_in_bill[op_city]">
              <option>市</option>
            </select>
            <select id="" class="level_3 input-medium input-small pull-left radius_no_tl select2" name="stock_in_bill[op_district]">
              <option>区</option>
            </select>
          </div>
          <%= f.input :logistic_id,label: "物流公司", collection: Logistic.all.collect {|x| [x.name,x.id]},as: :select, input_html: {class: "input-small select2 logictic"} %>
          
          <%= f.input :stocked_at, label: "入库时间",input_html: {class: "input-medium js-datetimepicker"} %>
        </fieldset><!-- form right area -->
        <fieldset>
          <div class="control-group">
            <%= f.label :remark,"备注",:class => "control-label",:style => "width:70px" %>
            <%= f.text_area :remark,:class => "span9",:rows => "3" %>
          </div>
        </fieldset>
      </div>
      <% end %>

      <ul class="nav nav-tabs js-nav_tabs">
        <li class="active"><a href="#good_info" data-toggle="tab">商品信息</a></li>
      </ul>
      <%= form_tag add_product_stock_in_bills_path,:class => "form-horizontal",:remote => true do  %>
      <%= hidden_field_tag "id",params[:id] %>
      <div class="btn-toolbar">
        <%= button_tag "添加",:class => "btn btn-warning btn-small", :onclick => "if($('#product_title').val() == ''){alert('bunengweikong');return false}" %>
      </div>
      <fieldset>
        <div class="control-group">
          <%= label_tag "product[sku_id]", "商品名称",:class => "control-label",:style => "width:70px;text-align:left;" %>
          <%= select_tag "product[sku_id]",options_for_select(current_account.skus.collect {|x| [x.title,x.id]}),:include_blank => true,:class => "input-small pull-left radius_no select2 product" ,:id => "product_title"%>
        </div>
      </fieldset>
      <div>
        <fieldset class="span6">
          <div class="control-group">
            <label class="control-label">数量：</label>
            <input type="text" class="input-medium" name="product[number]" placeholder="10">
          </div>
          <div class="control-group">
            <label class="control-label">单价：</label>
            <input type="text" class="input-medium" placeholder="100" name="product[price]">
          </div>
        </fieldset><!-- form left area -->
        <fieldset class="span6">
          <div class="control-group">
            <label class="control-label">&nbsp;</label>
          <!-- <select class="input-small select2">
            <option value="红">红</option>
          </select> -->
        </div>
        <div class="control-group">
          <label class="control-label">实际总价：</label>
          <input type="text" class="input-medium" placeholder="500" name="product[total_price]">
        </div>
      </fieldset><!-- form right area -->
    </div> 
    <% end %>
    <div id="products">
      <%= render :partial => "products",:locals => {:products => @products} %>
    </div>
  </div><!--span10 -->
</div><!--row-fluid -->

<% content_for :tail do -%>
<%= javascript_include_tag "LinkageSelect.js" %>
<script type="text/javascript">
$(function() {
  var options = {
    data  : linkage_data
  }
  var sel = new LinkageSelect(options);
  sel.bind('.level_1','<%= @bill.op_state %>');
  sel.bind('.level_2','<%= @bill.op_city %>');
  sel.bind('.level_3','<%= @bill.op_district %>');
});
</script>
<% end -%>